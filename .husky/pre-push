#!/usr/bin/env sh

# Husky Git pre-push hook
# Set SKIP_PREPUSH=1 to bypass (e.g., CI or emergency)
[ "" = "1" ] && echo 'Skipping pre-push via SKIP_PREPUSH' && exit 0

# Ensure we run from repo root for workspace scripts
cd -- "$(git rev-parse --show-toplevel)" || exit 1

# Run format, lint, type-check, and tests
echo 'Running format...'
npm run format || exit 1

echo 'Running lint...'
npm run lint || exit 1

echo 'Running type-check...'
npm run type-check || exit 1

# Run tests unless skipped via SKIP_TESTS=1
if [ "$SKIP_TESTS" != "1" ]; then
  echo 'Running tests...'
  npm test || exit 1
else
  echo 'Skipping tests via SKIP_TESTS'
fi
